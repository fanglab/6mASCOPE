
"""
Test sample name propagation in mapping
"""

import unittest
import logging

from pbcore.io import openDataSet

from pysiv2.custom.base import TestValuesLoader, setUpFindAlignments

log = logging.getLogger(__name__)


class TestMappedSampleNames(TestValuesLoader):

    def setUp(self):
        super(TestMappedSampleNames, self).setUp()
        setUpFindAlignments(self)

    def test_mapped_sample_names(self):
        expected = self.test_values["sample_names"]
        with openDataSet(self.alignment_file_name, skipCounts=True) as ds:
            samples = {rg.MovieName:rg.SampleName for rg in ds.readGroupTable}
            self.assertEqual(len(samples.keys()), len(expected.keys()))
            for movie_name in expected.keys():
                self.assertEqual(samples[movie_name], expected[movie_name],
                                 "Wrong sample name for %s"%movie_name)
